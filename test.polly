external id1 : string
external id2 : string


// The base uri for the external service
define base-uri : string as
  "https://jsonplaceholder.typicode.com/todos/"


define request-result1 : json as
  parse-json (http-get (concat { base-uri, id1 }))

define title1 : string as
  // table
  //   get-string (get-field request-result1 "title")
  // | #success as x -> x
  // | #error        ->
   "title1"
//  end

define userId1 : integer as 23
  //get-integer (get-field request-result1 "userId")


define request-result2 : json as
  parse-json (http-get (concat { base-uri, id2 }))

define title2 : string as
  get-string (get-field request-result2 "title")

define userId2 : integer as
  get-integer (get-field request-result2 "userId")



define decision : Permit | Deny | NotApplicable as
  table
    eq-string? title1 title2
  | True                     -> Permit
  | False                    -> Deny
  end

define decision-as-string : string as
  table
    decision, title1
  | _,        ("foop" | "title1")   -> "NAARGLE"
  | Permit,   _          -> "PERMIT"
  | _,        _          -> "DENY"
  end

define main : json as
  object { field "title1"  (json-string title1)
         , field "userId1" (json-number userId1)
         , field "title2"  (json-string title2)
         , field "userId2" (json-number userId2)
         , field "decision" (json-string decision-as-string)
         }
