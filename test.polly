external id1 : string
external id2 : string


// The base uri for the external service
define base-uri : string as
  "https://jsonplaceholder.typicode.com/todos/"


define request-result1 : json as
  parse-json (http-get (concat { base-uri, id1 }))

define title1 : string as
  first-successful
    { get-string (get-field request-result1 "title")
    , "backup title1"
    }

define userId1 : integer as
  first-successful
    { get-integer (get-field request-result1 "userId")
    , -1
    }


define request-result2 : json as
  parse-json (http-get (concat { base-uri, id2 }))

define title2 : string as
  first-successful
    { get-string (get-field request-result2 "title")
    , "backup title2"
    }

define userId2 : integer as
  first-successful
    { get-integer (get-field request-result2 "userId")
    , -1
    }



define policy : decision as
  first-applicable
    { guard (eq-string? title1 title2) PERMIT
    , DENY
    }


define main : json as
  object { field "title1"  (json-string title1)
         , field "userId1" (json-number userId1)
         , field "title2"  (json-string title2)
         , field "userId2" (json-number userId2)
         , field "decision" (json-string (if (permits policy) "PERMIT" "DENY"))
         }
